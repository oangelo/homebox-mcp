#!/command/with-contenv bashio
# shellcheck shell=bash
# ==============================================================================
# Home Assistant Add-on: Homebox MCP Server
# Runs the MCP server for Homebox inventory management
# ==============================================================================

bashio::log.info "Starting Homebox MCP Server..."

# Export configuration as environment variables
export HOMEBOX_URL="$(bashio::config 'homebox_url')"
export HOMEBOX_TOKEN="$(bashio::config 'homebox_token')"
export MCP_AUTH_ENABLED="$(bashio::config 'mcp_auth_enabled')"
export MCP_AUTH_TOKEN="$(bashio::config 'mcp_auth_token')"
export LOG_LEVEL="$(bashio::config 'log_level')"

bashio::log.info "Connecting to Homebox at: ${HOMEBOX_URL}"

if bashio::config.true 'mcp_auth_enabled'; then
    bashio::log.info "MCP Authentication: ENABLED"
else
    bashio::log.warning "MCP Authentication: DISABLED - Anyone can access the MCP endpoint"
fi

# Run the MCP server
exec python3 /app/server.py
